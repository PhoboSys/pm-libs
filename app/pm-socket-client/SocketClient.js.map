{"version":3,"file":"SocketClient.js","names":["_logger","_interopRequireDefault","require","e","__esModule","_defineProperties","r","t","length","o","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","prototype","_classCallCheck","a","n","TypeError","_classPrivateMethodInitSpec","_checkPrivateRedeclaration","add","_classPrivateFieldInitSpec","set","has","_defineProperty","value","i","_toPrimitive","_typeof","Symbol","toPrimitive","call","String","Number","_classPrivateFieldGet","s","get","_assertClassBrand","arguments","_onError","WeakMap","_onClose","_onOpen","_onMessage","_SocketClient_brand","WeakSet","SocketClient","exports","config","_this","logger","info","baseUrl","_wsClient","WebSocket","onerror","onopen","onmessage","onclose","error","onConnectionClosed","onConnectionOpened","_ref","data","msg","_parse","onMessageReceived","Promise","resolve","reject","JSON","stringify","readyState","OPEN","send","rawdata","parse","ex"],"sources":["../../libs/pm-socket-client/SocketClient.js"],"sourcesContent":["import logger from '../logger'\n\nexport class SocketClient {\n\n  constructor(config) {\n    this.baseUrl = config.baseUrl\n    this.onMessageReceived = config.onMessageReceived\n    this.onConnectionOpened = config.onConnectionOpened\n    this.onConnectionClosed = config.onConnectionClosed\n  }\n\n  connect = () => {\n    logger.info('ws connecting to: %s', this.baseUrl)\n\n    this._wsClient = new WebSocket(this.baseUrl)\n    this._wsClient.onerror = this.#onError\n    this._wsClient.onopen = this.#onOpen\n    this._wsClient.onmessage = this.#onMessage\n    this._wsClient.onclose = this.#onClose\n  }\n\n  #onError = (e) => {\n    logger.error(e)\n  }\n\n  #onClose = () => {\n    logger.info('ws closing connection! url: %s', this.baseUrl)\n\n    if (this.onConnectionClosed) this.onConnectionClosed()\n  }\n\n  #onOpen = () => {\n    logger.info('ws successfully opened! url: %s', this.baseUrl)\n\n    if (this.onConnectionOpened) this.onConnectionOpened()\n  }\n\n  #onMessage = ({ data }) => {\n    logger.info('ws message received: %s', data)\n\n    const msg = this.#parse(data)\n    if (msg && this.onMessageReceived) this.onMessageReceived(msg)\n  }\n\n  #parse(rawdata) {\n    try {\n      return JSON.parse(rawdata)\n    } catch (ex) {\n      logger.error(ex)\n    }\n    return {}\n  }\n\n  send = (data) => new Promise((resolve, reject) => {\n    const msg = JSON.stringify(data)\n\n    logger.info('ws message sent: %s', msg)\n\n    if (!this._wsClient) {\n      logger.error('ws failed to send message, no websocket client')\n      reject()\n    }\n\n    if (this._wsClient.readyState !== WebSocket.OPEN) {\n      logger.error('ws failed to send message, connection is not opened')\n      reject()\n    }\n\n    this._wsClient.send(msg)\n    resolve()\n  })\n}\n"],"mappings":"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","ignoreList":[]}